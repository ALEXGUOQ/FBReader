#!/usr/bin/make -f
## ----------------------------------------------------------------------
## debian/rules : package script for fbreader
## ----------------------------------------------------------------------

## ----------------------------------------------------------------------
## uncomment this to turn on verbose mode
#export DH_VERBOSE=1

## ----------------------------------------------------------------------
DEB_BUILD_GNU_TYPE ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
DEB_HOST_GNU_TYPE  ?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)

## ----------------------------------------------------------------------
DEB_DIR		= $(CURDIR)/debian

## ----------------------------------------------------------------------
## targets

clean:
		dh_testdir
		dh_testroot
		[ ! -f Makefile ] || $(MAKE) distclean
		dh_clean build-stamp install-stamp

build:		build-stamp
build-stamp:
		dh_testdir
		$(MAKE) -C zlibrary/core TARGET_ARCH=desktop UI_TYPE=dummy
		$(MAKE) -C zlibrary/text TARGET_ARCH=desktop UI_TYPE=dummy
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=gtk
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=qt
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=qt4
		$(MAKE) -C fbreader TARGET_ARCH=desktop UI_TYPE=dummy
		touch build-stamp 

install:	install-stamp
install-stamp:	build
		dh_testdir
		dh_testroot
		dh_clean -k
		dh_installdirs
		$(MAKE) -C zlibrary/core TARGET_ARCH=desktop UI_TYPE=dummy DESTDIR=$(DEB_DIR)/libzlcore do_install
		$(MAKE) -C zlibrary/text TARGET_ARCH=desktop UI_TYPE=dummy DESTDIR=$(DEB_DIR)/libzltext do_install
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=gtk DESTDIR=$(DEB_DIR)/libzlui-gtk do_install
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=qt DESTDIR=$(DEB_DIR)/libzlui-qt do_install
		$(MAKE) -C zlibrary/ui TARGET_ARCH=desktop UI_TYPE=qt4 DESTDIR=$(DEB_DIR)/libzlui-qt4 do_install
		$(MAKE) -C fbreader TARGET_ARCH=desktop UI_TYPE=dummy DESTDIR=$(DEB_DIR)/fbreader do_install
		touch install-stamp

binary-indep:

binary-arch:	build install
		dh_testdir
		dh_testroot
		dh_compress -a
		dh_fixperms -a
		dh_installdeb -a
		dh_shlibdeps -a -l $(PWD)/debian/libzlcore/usr/lib
		dh_shlibdeps -a -l $(PWD)/debian/libzltext/usr/lib
		dh_gencontrol -a
		dh_md5sums -a
		dh_builddeb -a

binary:		binary-indep binary-arch

.PHONY:		clean build install binary-indep binary-arch binary

## ----------------------------------------------------------------------
